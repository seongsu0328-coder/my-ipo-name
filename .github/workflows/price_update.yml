name: 15-Min Price Updater

on:
  schedule:
    # ë§¤ 15ë¶„ë§ˆë‹¤ ì‹¤í–‰ (0, 15, 30, 45ë¶„)
    - cron: '*/15 * * * *'
  
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-price:
    runs-on: ubuntu-latest
    
    # ğŸš¨ 1. í™˜ê²½ë³€ìˆ˜ë¥¼ ìœ„ë¡œ ì˜¬ë¦¬ê³ , íŒŒì´ì¬ ìºì‹œ íŒŒì¼(.pyc) ìƒì„± ë°©ì§€ ì˜µì…˜ ì¶”ê°€
    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      PYTHONDONTWRITEBYTECODE: 1

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: íŒŒì´ì¬ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
        # ğŸš¨ 2. ìºì‹œ ë¬´ì‹œ + ìµœì‹  ë²„ì „ ê°•ì œ ì„¤ì¹˜ (supabase ë¹¼ê³  requests ë„£ìŒ)
        run: |
          pip install --no-cache-dir --upgrade yfinance pandas requests pytz

      - name: ì£¼ê°€ ì—…ë°ì´íŠ¸ ì‹¤í–‰
        # envëŠ” ìœ„ë¡œ ì˜¬ë ¸ìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì‹¤í–‰ ëª…ë ¹ì–´ë§Œ ê¹”ë”í•˜ê²Œ ë‚¨ê¹ë‹ˆë‹¤.
        run: python price_worker.py
